{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block content %}
<div class="body normal">
    <h1 class="title">{{ page.title }}</h1>

    <div id="{{ page.title|slugify }}" class="exhibition-listing-item exhibition-title">
        <section class="exhibition-header">
            <section>
                <h2>{{ page.title }}</h2>
                <section class="exhibition-header__artists">
                    {% for artist in page.artists %}
                        <a href="{{ artist.url }}">
                            <p>{{ artist.name }}</p>
                        </a>
                    {% endfor %}
                </section>
            </section>
            <h3>{{ page.get_formatted_date_short }}</h3>
        </section>

        {% if page.body %}
            {% include_block page.body %}
        {% else %}
            <section class="exhibition-media">
                <section class="exhibition-card">
                    {% if page.featured_image %}
                        {% image page.featured_image width-1440 as img %}
                        <img src="{{ img.url }}" alt="The promotional showcard for the exhibition '{{ page.title }}' by This is a House Gallery."
                            class="quickview-item" width="{{ img.width }}" height="{{ img.height }}">
                    {% endif %}
                </section>

                <section class="exhibition-images">
                    {% if page.artworks %}
                        {% for artwork in page.artworks %}
                            <a href="{{ artwork.url }}" class="artwork-link">
                                {% if artwork.featured_image %}
                                    {% image artwork.featured_image width-1440 format-webp as img %}
                                    <img src="{{ img.url }}" alt="{{ artwork.title }}"
                                        role="img" width="{{ img.width }}" height="{{ img.height }}"
                                        loading="lazy" decoding="async">
                                {% endif %}
                            </a>
                        {% endfor %}
                    {% endif %}
                </section>
            </section>
        {% endif %}

        {% if page.description %}
        <div class="exhibition-description rich-text-block">
            {{ page.description|richtext }}
        </div>
        {% endif %}

        {% with exhibition_images=page.get_exhibition_images opening_images=page.get_opening_images %}
            {% if exhibition_images %}
                <div class="exhibition-gallery-section">
                    <h3>Exhibition Gallery</h3>
                    <div class="gallery-container columns">
                        {% for gallery_image in exhibition_images %}
                            <div class="gallery-item">
                                {% image gallery_image.image width-800 as img %}
                                <img src="{{ img.url }}" alt="{{ gallery_image.caption|default:page.title }}"
                                     width="{{ img.width }}" height="{{ img.height }}"
                                     loading="lazy" decoding="async">
                                {% if gallery_image.caption %}
                                    <p class="gallery-caption">{{ gallery_image.caption }}</p>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            {% if opening_images %}
                <div class="opening-gallery-section">
                    <h3>Opening Gallery</h3>
                    <div class="gallery-container columns">
                        {% for gallery_image in opening_images %}
                            <div class="gallery-item">
                                {% image gallery_image.image width-800 as img %}
                                <img src="{{ img.url }}" alt="{{ gallery_image.caption|default:page.title }}"
                                     width="{{ img.width }}" height="{{ img.height }}"
                                     loading="lazy" decoding="async">
                                {% if gallery_image.caption %}
                                    <p class="gallery-caption">{{ gallery_image.caption }}</p>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endwith %}
    </div>
</div>
{% endblock %}
